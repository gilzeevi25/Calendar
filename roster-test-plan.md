<div dir="rtl">

# תכנית בדיקה ידנית — שיבוץ אוטומטי לתפקידים (3 ימים)

## הקדמה

**מטרה:** בדיקת השיבוץ האוטומטי של דף התפקידים (`roster.html`) על פני 3 ימים (26–28 באפריל 2026), עם 13 אנשים זמינים.

**למה 3 ימים?** יום 1 בודק שיבוץ בסיסי, יום 2 בודק מנוחה בין-יומית והוגנות, יום 3 בודק שיבוצים ידניים, כללי זוגות ופטורים.

**דרישות מוקדמות:**
- כל 13 האנשים בסטטוס "פעילות" או "החלפה-בסיס" בתאריכים 26–28 באפריל
- דף התפקידים פתוח בדפדפן (roster.html)
- חיבור ל-Apps Script פעיל (או עבודה מקומית)

---

## שלב 0 — הגדרות מקדימות

### 0.1 צמצום תבנית המשמרות

התבנית ברירת המחדל מכילה 11 משמרות = 19 מקומות ליום. זה יותר מדי עבור 13 אנשים עם מנוחה של 8 שעות. יש לצמצם ל-8 משמרות = 12 מקומות ליום.

**פתח את מודאל ההגדרות** (כפתור ⚙️ בראש הדף) ← לשונית **"תבנית משמרות"**.

**מחק** את המשמרות הבאות (לחץ על כפתור המחיקה ליד כל שורה):

| משמרת למחיקה | סיבה |
|---|---|
| שמירה 10:00–14:00 | צמצום שמירה מ-6 ל-3 משמרות |
| שמירה 14:00–18:00 | צמצום שמירה |
| שמירה 18:00–22:00 | צמצום שמירה |

**ודא** שנשארו בדיוק 8 שורות בתבנית:

| # | סוג משימה | שעת התחלה | שעת סיום |
|---|---|---|---|
| 1 | סיור | 06:00 | 14:00 |
| 2 | סיור | 14:00 | 22:00 |
| 3 | סיור | 22:00 | 06:00 |
| 4 | שמירה | 06:00 | 10:00 |
| 5 | שמירה | 22:00 | 02:00 |
| 6 | שמירה | 02:00 | 06:00 |
| 7 | תורנות מטבח | כל היום | כל היום |
| 8 | כח כונן | 22:00 | 22:00 |

### 0.2 התאמת סוגי משימות (min_team)

עבור ללשונית **"סוגי משימות"** ושנה:

| סוג משימה | min_team ישן | min_team חדש | שינוי |
|---|---|---|---|
| סיור | 3 | 2 | הורד מ-3 ל-2 |
| כח כונן | 3 | 2 | הורד מ-3 ל-2 |
| שמירה | 1 | 1 | ללא שינוי |
| תורנות מטבח | 1 | 1 | ללא שינוי |

> **חישוב:** 3 סיורים × 2 + 3 שמירות × 1 + 1 מטבח × 1 + 1 כוננות × 2 = 6 + 3 + 1 + 2 = **12 מקומות ליום**.
> עם 13 אנשים — כל יום אדם אחד מסתובב החוצה. מצוין לבדיקת הוגנות.

### 0.3 הגדרת תגיות כוח אדם

עבור ללשונית **"תגיות כוח אדם"** והגדר:

| שם | תגית |
|---|---|
| אדם 1 (לבחירתך) | ✅ קצין (תמיד מפקד) |
| אדם 2 | ✅ מפקד |
| אדם 3 | ✅ מפקד |
| אדם 4 | ✅ נהג |
| אדם 5 | ✅ נהג |
| שאר 8 האנשים | ללא תגית (חייל רגיל) |

> **למה?** סיור דורש מפקד ונהג (`requires_commander: true, requires_driver: true`). חייבים לפחות 3 אנשים עם תגיות מפקד/קצין ו-2 עם תגית נהג כדי לכסות 3 משמרות סיור במקביל (2 אנשים לכל סיור, אחד מהם מפקד/קצין ואחד נהג).

### 0.4 בדיקת פרמטרים

עבור ללשונית **"פרמטרים"** וודא:

- **מינימום שעות מנוחה:** 8
- **הגבלת ימים רצופים:** כבוי (לצורך הבדיקה)

**לחץ "שמור"** בתחתית המודאל.

---

## יום 1 — 26 באפריל 2026: שיבוץ בסיסי

### שלב 1.1 — יצירת משמרות

1. נווט לתאריך **26 באפריל 2026** (תצוגת יום).
2. לחץ על כפתור **"צור משמרות מתבנית"** (או שם דומה שיוצר משמרות לפי התבנית).
3. ודא שנוצרו **8 משמרות** בדיוק:
   - 3 × סיור (06–14, 14–22, 22–06)
   - 3 × שמירה (06–10, 22–02, 02–06)
   - 1 × תורנות מטבח (כל היום)
   - 1 × כח כונן (22–22)

### שלב 1.2 — הרצת שיבוץ אוטומטי

1. לחץ על כפתור **"שיבוץ אוטומטי"**.
2. המתן לסיום התהליך (הודעת הצלחה/אזהרה).

### שלב 1.3 — בדיקות יום 1

#### ✅ בדיקה 1.1: כל המשמרות מלאות
- [ ] כל 8 המשמרות מאוישות
- [ ] סה"כ 12 שיבוצים (חלק מהאנשים מופיעים ביותר ממשמרת אחת)
- [ ] אדם אחד בדיוק לא שובץ כלל (13 אנשים, 12 מקומות)

#### ✅ בדיקה 1.2: תפקידים נכונים
- [ ] בכל משמרת סיור: לפחות אחד מתויג כ"קצין" או "מפקד"
- [ ] בכל משמרת סיור: לפחות אחד מתויג כ"נהג"
- [ ] משמרות שמירה/מטבח: אין דרישת תפקיד — כל אדם תקין

#### ✅ בדיקה 1.3: אין הפרת מנוחה (בתוך היום)
- [ ] מי שמסיים סיור ב-14:00 **לא** משובץ לשמירה שמתחילה לפני 22:00
- [ ] מי שמסיים שמירה ב-10:00 **לא** משובץ לסיור שמתחיל לפני 18:00
- [ ] כלל: בין סיום משמרת לתחילת הבאה — לפחות 8 שעות

#### ✅ בדיקה 1.4: כח כונן
- [ ] כח כונן מאויש ב-2 אנשים
- [ ] לפחות אחד מתויג כ"מפקד" או "קצין" (כי `requires_commander: true`)

**רשום את שמות המשובצים ושעותיהם** — תצטרך את זה ליום 2.

---

## יום 2 — 27 באפריל 2026: מנוחה בין-יומית והוגנות

### שלב 2.1 — יצירת משמרות

1. נווט לתאריך **27 באפריל 2026**.
2. צור משמרות מתבנית — 8 משמרות זהות ליום 1.

### שלב 2.2 — הרצת שיבוץ אוטומטי

1. לחץ על **"שיבוץ אוטומטי"**.
2. האלגוריתם ייקח בחשבון את ההיסטוריה מיום 1.

### שלב 2.3 — בדיקות יום 2

#### ✅ בדיקה 2.1: מנוחה בין-יומית (הבדיקה החשובה ביותר)
- [ ] מי שסיים סיור לילה ב-06:00 ביום 26 **לא** משובץ לסיור בוקר 06:00–14:00 ביום 27 (פער של 0 שעות < 8)
- [ ] מי שסיים סיור לילה ב-06:00 ביום 26 **לא** משובץ לשמירה 06:00–10:00 ביום 27
- [ ] מי שסיים סיור לילה ב-06:00 ביום 26 **יכול** להיות משובץ מ-14:00 ביום 27 (פער 8 שעות — בדיוק מספיק)
- [ ] מי שהיה בכח כונן (22:00–22:00, 24 שעות) ביום 26 **לא** משובץ לפני 06:00 ביום 28

#### ✅ בדיקה 2.2: סיבוב הוגנות
- [ ] האדם שלא שובץ ביום 1 — **כן** משובץ ביום 2
- [ ] האדם שלא שובץ ביום 2 — **שונה** מהאדם שלא שובץ ביום 1
- [ ] אנשים שצברו הרבה שעות ביום 1 (למשל סיור + שמירה) מקבלים פחות שעות ביום 2

#### ✅ בדיקה 2.3: גיוון משימות
- [ ] מי שעשה סיור ביום 1 מועדף לשמירה/מטבח ביום 2 (לא חובה, אבל הניקוד מעדיף גיוון)
- [ ] בדוק שלא אותו אדם תמיד במטבח או תמיד בסיור

**רשום את סה"כ השעות לכל אדם** (יום 1 + יום 2) — תצטרך ליום 3.

---

## יום 3 — 28 באפריל 2026: שיבוצים ידניים, כללי זוגות ופטורים

### שלב 3.1 — הוספת פטור (Exclusion)

1. פתח **הגדרות** ← לשונית **"פטורים"**.
2. בחר אדם אחד (למשל: אדם 6) ← סמן ✅ ליד **"סיור"**.
3. לחץ **"שמור"**.

> **משמעות:** אדם 6 לא ישובץ לסיור, אבל כן לשמירה/מטבח/כוננות.

### שלב 3.2 — הוספת כלל זוגות (Buddy Rule)

1. פתח **הגדרות** ← לשונית **"כללי זוגות"**.
2. הוסף כלל חדש:
   - **סוג:** "אסור ביחד" (`must_not`)
   - **אדם 1:** אדם 7
   - **אדם 2:** אדם 8
3. לחץ **"שמור"**.

> **משמעות:** אדם 7 ואדם 8 לא ישובצו לאותה משמרת.

### שלב 3.3 — יצירת משמרות + שיבוצים ידניים

1. נווט לתאריך **28 באפריל 2026**.
2. צור משמרות מתבנית (8 משמרות).
3. **שבץ ידנית** לפני הרצת האוטומט:
   - **אדם 9** → סיור 06:00–14:00
   - **אדם 10** → שמירה 22:00–02:00

### שלב 3.4 — הרצת שיבוץ אוטומטי

1. לחץ על **"שיבוץ אוטומטי"**.
2. האלגוריתם ייקח בחשבון: היסטוריה מימים 1–2, שיבוצים ידניים, פטורים, כללי זוגות.

### שלב 3.5 — בדיקות יום 3

#### ✅ בדיקה 3.1: שיבוצים ידניים נשמרים
- [ ] אדם 9 עדיין משובץ לסיור 06:00–14:00
- [ ] אדם 10 עדיין משובץ לשמירה 22:00–02:00
- [ ] השיבוץ האוטומטי לא דרס ולא הזיז אותם

#### ✅ בדיקה 3.2: פטור נאכף
- [ ] אדם 6 **לא** מופיע באף משמרת סיור
- [ ] אדם 6 **כן** משובץ למשמרת אחרת (שמירה/מטבח/כוננות)

#### ✅ בדיקה 3.3: כלל זוגות נאכף
- [ ] אדם 7 ואדם 8 **לא** מופיעים באותה משמרת
- [ ] שניהם כן משובצים — רק לא ביחד

#### ✅ בדיקה 3.4: הוגנות מצטברת (3 ימים)
- [ ] חשב סה"כ שעות לכל אדם על פני 3 ימים
- [ ] הפרש בין האדם עם הכי הרבה שעות לאדם עם הכי מעט — לא יעלה על ~16 שעות (משמרת סיור + שמירה)
- [ ] כל אדם שובץ לפחות ב-2 מתוך 3 ימים

#### ✅ בדיקה 3.5: מנוחה תקינה גם ביום 3
- [ ] אין הפרת מנוחה בין יום 2 ליום 3 (אותם כללים כמו בדיקה 2.1)

---

## רשימת בדיקות מסכמת

### שלמות שיבוץ
- [ ] 3 ימים × 8 משמרות × מלא = 36 שיבוצי משמרות מלאים
- [ ] סה"כ 36 שיבוצי אנשים (12 ליום × 3 ימים)
- [ ] כל יום אדם אחד לא משובץ (אדם שונה כל יום)

### דרישות תפקידים
- [ ] כל 9 משמרות סיור (3 ימים × 3) מכילות מפקד/קצין + נהג
- [ ] כל 3 משמרות כוננות מכילות מפקד/קצין

### מנוחה
- [ ] אף אדם לא משובץ עם פחות מ-8 שעות מנוחה בין משמרות
- [ ] בדיקה ספציפית: סיור לילה (22–06) → מנוחה עד 14:00 לפחות

### הוגנות
- [ ] אין אדם שלא שובץ 2 ימים רצופים
- [ ] פערי שעות מצטברים סבירים (≤16 שעות בין מקסימום למינימום)

### אילוצים
- [ ] שיבוצים ידניים לא נדרסים
- [ ] פטורים נאכפים
- [ ] כללי זוגות "אסור ביחד" נאכפים

---

## פתרון בעיות

### בעיה: "לא ניתן למלא את כל המשמרות"
**סיבה אפשרית:** אין מספיק אנשים עם תגיות מפקד/נהג.
**פתרון:** ודא שיש לפחות 3 מפקדים/קצינים ו-2 נהגים (ראה שלב 0.3).

### בעיה: הפרת מנוחה מופיעה בתוצאות
**סיבה אפשרית:** שיבוץ ידני שיצר קונפליקט.
**פתרון:** השיבוץ האוטומטי לא יכול לדרוס שיבוצים ידניים. אם השיבוץ הידני עצמו מפר מנוחה, תתקבל אזהרה אבל הוא יישמר.

### בעיה: אותו אדם תמיד לא משובץ
**סיבה אפשרית:** לאדם אין תגיות ולכן ניקוד ההוגנות שלו נמוך יותר.
**פתרון:** בדוק את חלוקת התגיות. ייתכן שהאלגוריתם מעדיף אנשים עם תגיות כי הם יכולים למלא יותר תפקידים.

### בעיה: כלל זוגות לא נאכף
**סיבה אפשרית:** הכלל נשמר אבל שם האדם לא תואם בדיוק.
**פתרון:** פתח הגדרות ← כללי זוגות ← ודא שהשמות תואמים בדיוק לשמות ברשימת כוח האדם.

### בעיה: המשמרות לא נוצרות מהתבנית
**סיבה אפשרית:** התבנית המעודכנת לא נשמרה.
**פתרון:** פתח הגדרות ← תבנית משמרות ← ודא שיש 8 שורות ← לחץ "שמור" שוב.

### בעיה: אנשים מסומנים כלא זמינים
**סיבה אפשרית:** בלוח השנה הראשי הם בסטטוס "בבית" או "החלפה-בית".
**פתרון:** חזור ללוח השנה הראשי (`index.html`) ← ודא שכל 13 האנשים בסטטוס "פעילות" או "החלפה-בסיס" בתאריכים 26–28 באפריל.

---

## טבלת מעקב תוצאות

### יום 1 — 26 באפריל

| משמרת | סוג | שעות | משובץ 1 | משובץ 2 | תקין? |
|---|---|---|---|---|---|
| סיור בוקר | סיור | 06–14 | | | |
| סיור צהריים | סיור | 14–22 | | | |
| סיור לילה | סיור | 22–06 | | | |
| שמירה בוקר | שמירה | 06–10 | | — | |
| שמירה לילה 1 | שמירה | 22–02 | | — | |
| שמירה לילה 2 | שמירה | 02–06 | | — | |
| מטבח | מטבח | כל היום | | — | |
| כח כונן | כוננות | 22–22 | | | |

**לא שובץ:** _______________

### יום 2 — 27 באפריל

| משמרת | סוג | שעות | משובץ 1 | משובץ 2 | תקין? |
|---|---|---|---|---|---|
| סיור בוקר | סיור | 06–14 | | | |
| סיור צהריים | סיור | 14–22 | | | |
| סיור לילה | סיור | 22–06 | | | |
| שמירה בוקר | שמירה | 06–10 | | — | |
| שמירה לילה 1 | שמירה | 22–02 | | — | |
| שמירה לילה 2 | שמירה | 02–06 | | — | |
| מטבח | מטבח | כל היום | | — | |
| כח כונן | כוננות | 22–22 | | | |

**לא שובץ:** _______________

### יום 3 — 28 באפריל

| משמרת | סוג | שעות | משובץ 1 | משובץ 2 | תקין? |
|---|---|---|---|---|---|
| סיור בוקר | סיור | 06–14 | *(ידני: אדם 9)* | | |
| סיור צהריים | סיור | 14–22 | | | |
| סיור לילה | סיור | 22–06 | | | |
| שמירה בוקר | שמירה | 06–10 | | — | |
| שמירה לילה 1 | שמירה | 22–02 | *(ידני: אדם 10)* | — | |
| שמירה לילה 2 | שמירה | 02–06 | | — | |
| מטבח | מטבח | כל היום | | — | |
| כח כונן | כוננות | 22–22 | | | |

**לא שובץ:** _______________

### סיכום שעות מצטבר

| שם | שעות יום 1 | שעות יום 2 | שעות יום 3 | סה"כ | הערות |
|---|---|---|---|---|---|
| | | | | | |
| | | | | | |
| | | | | | |
| | | | | | |
| | | | | | |
| | | | | | |
| | | | | | |
| | | | | | |
| | | | | | |
| | | | | | |
| | | | | | |
| | | | | | |
| | | | | | |

</div>
