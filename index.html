<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>×œ×•×— ×¤×¢×™×œ×•×™×•×ª</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&family=Frank+Ruhl+Libre:wght@700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --clr-bg: #faf8f5;
    --clr-surface: #ffffff;
    --clr-border: #e8e2da;
    --clr-text: #1a1612;
    --clr-text-secondary: #6b5e52;
    --clr-text-tertiary: #9c8f82;
    --clr-activity: #16a34a;
    --clr-activity-bg: #dcfce7;
    --clr-home: #2563eb;
    --clr-home-bg: #dbeafe;
    --clr-shabbat: #eee9f7;
    --clr-shabbat-border: #d4c8e8;
    --clr-shabbat-text: #5b21b6;
    --clr-shavuot: #fef3c7;
    --clr-shavuot-border: #f59e0b;
    --clr-shavuot-text: #92400e;
    --radius: 10px;
    --shadow-sm: 0 1px 3px rgba(26,22,18,0.06);
    --shadow-md: 0 4px 16px rgba(26,22,18,0.08);
    --font-body: 'Heebo', sans-serif;
    --font-display: 'Frank Ruhl Libre', serif;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: var(--font-body);
    background: var(--clr-bg);
    color: var(--clr-text);
    line-height: 1.5;
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.025'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 0;
  }

  .app {
    position: relative;
    z-index: 1;
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem 1.5rem 4rem;
  }

  /* Header */
  .header {
    text-align: center;
    margin-bottom: 2.5rem;
    animation: fadeInDown 0.6s ease-out;
  }

  .header__title {
    font-family: var(--font-display);
    font-weight: 900;
    font-size: clamp(2.2rem, 5vw, 3.5rem);
    color: var(--clr-text);
    letter-spacing: -0.02em;
    margin-bottom: 0.25rem;
  }

  .header__subtitle {
    font-weight: 300;
    font-size: 1.05rem;
    color: var(--clr-text-secondary);
    letter-spacing: 0.01em;
  }

  .header__line {
    width: 60px;
    height: 3px;
    background: linear-gradient(90deg, var(--clr-activity), var(--clr-home));
    border-radius: 3px;
    margin: 1rem auto 0;
  }

  .header__sheet-link {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    margin-top: 0.75rem;
    font-size: 0.85rem;
    font-weight: 400;
    color: var(--clr-text-tertiary);
    text-decoration: none;
    transition: color 0.2s;
  }

  .header__sheet-link:hover {
    color: var(--clr-text-secondary);
  }

  .header__sheet-link svg {
    width: 16px;
    height: 16px;
    flex-shrink: 0;
  }

  /* Controls bar */
  .controls {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1.5rem;
    animation: fadeInUp 0.6s ease-out 0.15s both;
  }

  .filter-group {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .filter-group__label {
    font-weight: 500;
    font-size: 0.95rem;
    color: var(--clr-text-secondary);
  }

  .filter-select {
    appearance: none;
    -webkit-appearance: none;
    font-family: var(--font-body);
    font-size: 0.95rem;
    font-weight: 500;
    color: var(--clr-text);
    background: var(--clr-surface);
    border: 1.5px solid var(--clr-border);
    border-radius: var(--radius);
    padding: 0.6rem 2.5rem 0.6rem 1rem;
    cursor: pointer;
    box-shadow: var(--shadow-sm);
    transition: border-color 0.2s, box-shadow 0.2s;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%236b5e52'%3E%3Cpath d='M4 6l4 4 4-4'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: left 0.75rem center;
    min-width: 160px;
  }

  .filter-select:hover { border-color: #c4b8aa; }

  .filter-select:focus {
    outline: none;
    border-color: var(--clr-activity);
    box-shadow: 0 0 0 3px rgba(22,163,74,0.12);
  }

  /* Legend */
  .legend {
    display: flex;
    align-items: center;
    gap: 1.25rem;
    flex-wrap: wrap;
  }

  .legend__item {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.85rem;
    font-weight: 400;
    color: var(--clr-text-secondary);
  }

  .legend__dot {
    width: 12px;
    height: 12px;
    border-radius: 3px;
    flex-shrink: 0;
  }

  .legend__dot--activity { background: var(--clr-activity); }
  .legend__dot--home { background: var(--clr-home); }
  .legend__dot--switch { background: linear-gradient(135deg, var(--clr-activity) 50%, var(--clr-home) 50%); }
  .legend__dot--shabbat { background: var(--clr-shabbat); border: 1px solid var(--clr-shabbat-border); }
  .legend__dot--shavuot { background: var(--clr-shavuot); border: 1px solid var(--clr-shavuot-border); }

  /* Calendar wrapper */
  .calendar-wrap {
    background: var(--clr-surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow-md);
    overflow: hidden;
    border: 1px solid var(--clr-border);
    animation: fadeInUp 0.6s ease-out 0.3s both;
  }

  .cal-headers {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
  }

  .cal-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
  }

  /* Day headers */
  .cal-header {
    padding: 0.75rem 0.5rem;
    text-align: center;
    font-weight: 700;
    font-size: 0.85rem;
    color: var(--clr-text-secondary);
    background: #f5f1ec;
    border-bottom: 1.5px solid var(--clr-border);
    user-select: none;
  }

  .cal-header--shabbat {
    color: var(--clr-shabbat-text);
    background: #ebe4f3;
  }

  /* Day cell */
  .cal-cell {
    min-height: 90px;
    padding: 0.5rem;
    border-bottom: 1px solid var(--clr-border);
    border-inline-start: 1px solid var(--clr-border);
    position: relative;
    transition: background 0.2s;
    display: flex;
    flex-direction: column;
  }

  .cal-grid > :nth-child(7n + 1) {
    border-inline-start: none;
  }

  .cal-cell--empty {
    background: #fdfcfa;
  }

  .cal-cell--shabbat {
    background: var(--clr-shabbat);
  }

  .cal-cell--shavuot {
    background: var(--clr-shavuot);
    box-shadow: inset 0 0 0 1.5px var(--clr-shavuot-border);
  }

  .cal-cell--shavuot.cal-cell--shabbat {
    background: linear-gradient(135deg, var(--clr-shavuot) 60%, var(--clr-shabbat) 100%);
  }

  .cal-cell--status-activity {
    background: var(--clr-activity-bg);
  }

  .cal-cell--status-home {
    background: var(--clr-home-bg);
  }

  .cal-cell--status-activity .cell-greg {
    color: #15803d;
  }

  .cal-cell--status-home .cell-greg {
    color: #1d4ed8;
  }

  .cal-cell--status-activity .cell-status-label {
    color: #15803d;
    font-weight: 500;
    font-size: 0.75rem;
  }

  .cal-cell--status-home .cell-status-label {
    color: #1d4ed8;
    font-weight: 500;
    font-size: 0.75rem;
  }

  .cal-cell--status-switch-home {
    background: linear-gradient(135deg, var(--clr-home-bg) 50%, var(--clr-activity-bg) 50%);
  }

  .cal-cell--status-switch-base {
    background: linear-gradient(135deg, var(--clr-activity-bg) 50%, var(--clr-home-bg) 50%);
  }

  .cal-cell--status-switch-home .cell-greg,
  .cal-cell--status-switch-base .cell-greg {
    color: var(--clr-text);
  }

  .cal-cell--status-switch-home .cell-status-label,
  .cal-cell--status-switch-base .cell-status-label {
    color: var(--clr-text-secondary);
    font-weight: 500;
    font-size: 0.75rem;
  }

  .cal-cell--shabbat.cal-cell--status-activity {
    background: linear-gradient(135deg, var(--clr-activity-bg) 70%, var(--clr-shabbat) 100%);
  }

  .cal-cell--shabbat.cal-cell--status-home {
    background: linear-gradient(135deg, var(--clr-home-bg) 70%, var(--clr-shabbat) 100%);
  }

  .cal-cell--shabbat.cal-cell--status-switch-home {
    background: linear-gradient(135deg, var(--clr-home-bg) 40%, var(--clr-activity-bg) 40%, var(--clr-activity-bg) 60%, var(--clr-shabbat) 100%);
  }

  .cal-cell--shabbat.cal-cell--status-switch-base {
    background: linear-gradient(135deg, var(--clr-activity-bg) 40%, var(--clr-home-bg) 40%, var(--clr-home-bg) 60%, var(--clr-shabbat) 100%);
  }

  .cal-cell:not(.cal-cell--empty):hover {
    filter: brightness(0.97);
  }

  /* Month indicator inside cell */
  .cell-month-tag {
    font-family: var(--font-display);
    font-weight: 700;
    font-size: 0.7rem;
    color: var(--clr-text-tertiary);
    margin-bottom: 0.15rem;
  }

  /* Date info inside cell */
  .cell-top {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 0.25rem;
  }

  .cell-greg {
    font-weight: 700;
    font-size: 1rem;
    line-height: 1.2;
    color: var(--clr-text);
  }

  .cell-holiday {
    font-weight: 700;
    font-size: 0.7rem;
    color: var(--clr-shavuot-text);
    background: rgba(245,158,11,0.18);
    padding: 1px 5px;
    border-radius: 4px;
    display: inline-block;
    margin-bottom: 0.2rem;
    line-height: 1.4;
  }

  .cell-note {
    font-size: 0.65rem;
    color: #92400e;
    background: #fef9c3;
    padding: 1px 5px;
    border-radius: 4px;
    display: inline-block;
    margin-top: 0.15rem;
    line-height: 1.4;
    border: 1px solid #fde68a;
  }

  .cell-note::before {
    content: 'ğŸ“ ';
  }

  .cell-special {
    font-weight: 700;
    font-size: 0.7rem;
    color: #7f1d1d;
    background: rgba(239,68,68,0.12);
    padding: 1px 5px;
    border-radius: 4px;
    display: inline-block;
    margin-bottom: 0.2rem;
    line-height: 1.4;
  }

  /* Status display */
  .cell-status {
    margin-top: auto;
  }

  .status-summary {
    font-size: 0.7rem;
    line-height: 1.5;
    color: var(--clr-text-secondary);
  }

  .summary-row {
    display: flex;
    align-items: center;
    gap: 0.3rem;
  }

  .summary-dot {
    width: 7px;
    height: 7px;
    border-radius: 2px;
    flex-shrink: 0;
  }

  .summary-dot--activity { background: var(--clr-activity); }
  .summary-dot--home { background: var(--clr-home); }
  .summary-dot--switch { background: linear-gradient(135deg, var(--clr-activity) 50%, var(--clr-home) 50%); }

  /* Loading */
  .loading {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--clr-text-secondary);
    font-size: 1.1rem;
  }

  .loading__spinner {
    width: 32px;
    height: 32px;
    border: 3px solid var(--clr-border);
    border-top-color: var(--clr-activity);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin: 0 auto 1rem;
  }

  /* Animations */
  @keyframes fadeInDown {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* Responsive */
  @media (max-width: 768px) {
    .app { padding: 1rem 0.5rem 3rem; }
    .controls { flex-direction: column; align-items: stretch; }
    .legend { justify-content: center; }
    .filter-group { justify-content: center; }
    .cal-cell { min-height: 70px; padding: 0.35rem; }
    .cell-greg { font-size: 0.85rem; }
    .status-summary { font-size: 0.6rem; }
    .toolbar { justify-content: center; }
    .save-bar { justify-content: center; font-size: 0.8rem; }
    .save-bar__btn { font-size: 0.75rem; padding: 0.35rem 0.6rem; }
    .status-picker { min-width: 120px; }
    .note-popup, .add-people-modal { max-width: 95vw; }
  }

  @media (max-width: 480px) {
    .cal-cell { min-height: 58px; padding: 0.25rem; }
    .cell-greg { font-size: 0.78rem; }
    .cal-header { font-size: 0.72rem; padding: 0.5rem 0.25rem; }
    .cell-holiday { font-size: 0.6rem; }
    .toolbar__btn { font-size: 0.78rem; padding: 0.4rem 0.75rem; }
  }

  /* Day detail modal */
  .day-modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(26,22,18,0.45);
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.2s ease-out;
    padding: 1rem;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .day-modal {
    background: var(--clr-surface);
    border-radius: var(--radius);
    box-shadow: 0 12px 40px rgba(26,22,18,0.2);
    max-width: 400px;
    width: 100%;
    max-height: 80vh;
    overflow-y: auto;
    animation: fadeInUp 0.25s ease-out;
  }

  .day-modal__header {
    padding: 1.25rem 1.5rem 1rem;
    border-bottom: 1px solid var(--clr-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .day-modal__title {
    font-family: var(--font-display);
    font-weight: 700;
    font-size: 1.2rem;
    color: var(--clr-text);
  }

  .day-modal__close {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: var(--clr-text-tertiary);
    cursor: pointer;
    padding: 0.25rem;
    line-height: 1;
    border-radius: 4px;
    transition: background 0.15s, color 0.15s;
  }

  .day-modal__close:hover {
    background: #f0ece7;
    color: var(--clr-text);
  }

  .day-modal__body {
    padding: 1rem 1.5rem 1.5rem;
  }

  .day-modal__group {
    margin-bottom: 1rem;
  }

  .day-modal__group:last-child {
    margin-bottom: 0;
  }

  .day-modal__group-title {
    font-weight: 700;
    font-size: 0.85rem;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }

  .day-modal__group-title--activity {
    color: #15803d;
  }

  .day-modal__group-title--home {
    color: #1d4ed8;
  }

  .day-modal__group-title--switch {
    color: var(--clr-text-secondary);
  }

  .day-modal__list {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
  }

  .day-modal__person {
    font-size: 0.9rem;
    color: var(--clr-text);
    padding: 0.35rem 0.6rem;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .day-modal__person--activity {
    background: var(--clr-activity-bg);
  }

  .day-modal__person--home {
    background: var(--clr-home-bg);
  }

  .day-modal__person--switch {
    background: linear-gradient(135deg, #f0fdf4 50%, #eff6ff 50%);
  }

  .day-modal__person-note {
    font-size: 0.7rem;
    color: #92400e;
    background: #fef9c3;
    padding: 1px 5px;
    border-radius: 4px;
    border: 1px solid #fde68a;
  }

  .cal-cell--clickable {
    cursor: pointer;
  }

  .cal-cell--clickable:hover {
    outline: 2px solid var(--clr-activity);
    outline-offset: -2px;
    z-index: 1;
  }

  /* Examples floating button & popup */
  .examples-fab {
    position: fixed;
    bottom: 1.5rem;
    left: 1.5rem;
    z-index: 1000;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: none;
    background: linear-gradient(135deg, #229ED9, #1a8ac4);
    color: #fff;
    font-size: 1.35rem;
    cursor: pointer;
    box-shadow: 0 4px 16px rgba(34,158,217,0.35);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s, box-shadow 0.2s;
    line-height: 1;
  }

  .examples-fab:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 24px rgba(34,158,217,0.45);
  }

  .examples-fab:active {
    transform: scale(0.95);
  }

  .examples-fab svg {
    width: 24px;
    height: 24px;
    fill: #fff;
  }

  .examples-overlay {
    position: fixed;
    inset: 0;
    z-index: 1001;
    background: rgba(26,22,18,0.4);
    backdrop-filter: blur(4px);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.25s, visibility 0.25s;
  }

  .examples-overlay--open {
    opacity: 1;
    visibility: visible;
  }

  .examples-panel {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 1002;
    max-height: 80vh;
    background: var(--clr-surface);
    border-radius: var(--radius) var(--radius) 0 0;
    box-shadow: 0 -8px 40px rgba(26,22,18,0.15);
    transform: translateY(100%);
    transition: transform 0.3s cubic-bezier(0.4,0,0.2,1);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .examples-panel--open {
    transform: translateY(0);
  }

  .examples-panel__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.25rem;
    border-bottom: 1px solid var(--clr-border);
    flex-shrink: 0;
  }

  .examples-panel__title {
    font-family: var(--font-display);
    font-weight: 700;
    font-size: 1.2rem;
    color: var(--clr-text);
  }

  .examples-panel__close {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: none;
    background: transparent;
    color: var(--clr-text-secondary);
    font-size: 1.3rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.15s;
    line-height: 1;
  }

  .examples-panel__close:hover {
    background: #f0ebe5;
  }

  .examples-panel__body {
    overflow-y: auto;
    padding: 0.75rem 1.25rem 1.5rem;
    flex: 1;
  }

  .example-item {
    margin-bottom: 0.75rem;
  }

  .example-item__label {
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--clr-text-tertiary);
    margin-bottom: 0.3rem;
  }

  .example-item__row {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: #f5f1ec;
    border: 1px solid var(--clr-border);
    border-radius: 8px;
    padding: 0.55rem 0.75rem;
    transition: border-color 0.15s;
  }

  .example-item__row:hover {
    border-color: #c4b8aa;
  }

  .example-item__text {
    flex: 1;
    font-family: var(--font-body);
    font-size: 0.88rem;
    color: var(--clr-text);
    direction: rtl;
    word-break: break-word;
    line-height: 1.5;
  }

  .example-item__copy {
    flex-shrink: 0;
    width: 32px;
    height: 32px;
    border-radius: 6px;
    border: none;
    background: transparent;
    color: var(--clr-text-tertiary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.15s, color 0.15s;
    position: relative;
  }

  .example-item__copy:hover {
    background: var(--clr-surface);
    color: var(--clr-text);
  }

  .example-item__copy svg {
    width: 16px;
    height: 16px;
  }

  .example-item__copy--copied {
    color: var(--clr-activity) !important;
  }

  .example-item__feedback {
    position: absolute;
    top: -1.6rem;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.7rem;
    font-weight: 500;
    color: var(--clr-activity);
    background: #dcfce7;
    padding: 2px 8px;
    border-radius: 4px;
    white-space: nowrap;
    opacity: 0;
    transition: opacity 0.2s;
    pointer-events: none;
  }

  .example-item__feedback--show {
    opacity: 1;
  }

  /* Toolbar */
  .toolbar {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .toolbar__modes {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .toolbar__btn {
    font-family: var(--font-body);
    font-size: 0.85rem;
    font-weight: 500;
    padding: 0.5rem 1rem;
    border-radius: var(--radius);
    border: 1.5px solid var(--clr-border);
    background: var(--clr-surface);
    color: var(--clr-text);
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: var(--shadow-sm);
    white-space: nowrap;
  }

  .toolbar__btn:hover {
    border-color: #c4b8aa;
    background: #f5f1ec;
  }

  .toolbar__btn--active {
    border-color: var(--clr-activity);
    background: var(--clr-activity-bg);
    color: #15803d;
    box-shadow: 0 0 0 3px rgba(22,163,74,0.12);
  }

  .toolbar__btn--cancel {
    border-color: #ef4444;
    color: #dc2626;
  }

  .toolbar__btn--cancel:hover {
    background: #fef2f2;
  }

  .toolbar__btn--add-people {
    border-color: var(--clr-home);
    color: var(--clr-home);
  }

  .toolbar__btn--add-people:hover {
    background: var(--clr-home-bg);
  }

  /* Save/discard bar */
  .save-bar {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.6rem 1rem;
    background: #fef9c3;
    border: 1.5px solid #fde68a;
    border-radius: var(--radius);
    flex-wrap: wrap;
    animation: fadeInUp 0.2s ease-out;
    margin-bottom: 1rem;
  }

  .save-bar__count {
    font-size: 0.85rem;
    font-weight: 500;
    color: #92400e;
  }

  .save-bar__btn {
    font-family: var(--font-body);
    font-size: 0.8rem;
    font-weight: 500;
    padding: 0.4rem 0.75rem;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
  }

  .save-bar__btn--save {
    background: var(--clr-activity);
    color: #fff;
  }

  .save-bar__btn--save:hover { background: #15803d; }

  .save-bar__btn--discard {
    background: #fee2e2;
    color: #dc2626;
  }

  .save-bar__btn--discard:hover { background: #fecaca; }

  .save-bar__btn--undo {
    background: #e0e7ff;
    color: #3730a3;
  }

  .save-bar__btn--undo:hover { background: #c7d2fe; }

  /* Toast */
  .toast-container {
    position: fixed;
    top: 1.5rem;
    left: 50%;
    transform: translateX(-50%);
    z-index: 2000;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    pointer-events: none;
  }

  .toast {
    background: var(--clr-text);
    color: #fff;
    padding: 0.75rem 1.25rem;
    border-radius: var(--radius);
    font-family: var(--font-body);
    font-size: 0.9rem;
    font-weight: 500;
    box-shadow: 0 8px 32px rgba(26,22,18,0.25);
    animation: toastIn 0.3s ease-out;
    pointer-events: auto;
    text-align: center;
    max-width: 90vw;
  }

  .toast--success { background: #15803d; }
  .toast--error { background: #dc2626; }
  .toast--info { background: #2563eb; }

  @keyframes toastIn {
    from { opacity: 0; transform: translateY(-12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes toastOut {
    from { opacity: 1; transform: translateY(0); }
    to { opacity: 0; transform: translateY(-12px); }
  }

  /* Note popup */
  .note-popup-overlay {
    position: fixed;
    inset: 0;
    background: rgba(26,22,18,0.45);
    z-index: 150;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.2s ease-out;
    padding: 1rem;
  }

  .note-popup {
    background: var(--clr-surface);
    border-radius: var(--radius);
    box-shadow: 0 12px 40px rgba(26,22,18,0.2);
    max-width: 360px;
    width: 100%;
    animation: fadeInUp 0.25s ease-out;
    padding: 1.25rem 1.5rem;
  }

  .note-popup__title {
    font-family: var(--font-display);
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 0.75rem;
    color: var(--clr-text);
  }

  .note-popup__input {
    width: 100%;
    font-family: var(--font-body);
    font-size: 0.95rem;
    padding: 0.6rem 0.75rem;
    border: 1.5px solid var(--clr-border);
    border-radius: 8px;
    direction: rtl;
    resize: vertical;
    min-height: 60px;
    transition: border-color 0.2s;
  }

  .note-popup__input:focus {
    outline: none;
    border-color: var(--clr-activity);
    box-shadow: 0 0 0 3px rgba(22,163,74,0.12);
  }

  .note-popup__actions {
    display: flex;
    gap: 0.5rem;
    margin-top: 1rem;
    justify-content: flex-start;
  }

  .note-popup__btn {
    font-family: var(--font-body);
    font-size: 0.85rem;
    font-weight: 500;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
  }

  .note-popup__btn--save {
    background: var(--clr-activity);
    color: #fff;
  }

  .note-popup__btn--save:hover { background: #15803d; }

  .note-popup__btn--cancel {
    background: #f5f1ec;
    color: var(--clr-text-secondary);
    border: 1px solid var(--clr-border);
  }

  .note-popup__btn--cancel:hover { background: #ede8e1; }

  .note-popup__btn--delete {
    background: #fef2f2;
    color: #dc2626;
    border: 1px solid #fecaca;
    margin-inline-start: auto;
  }

  .note-popup__btn--delete:hover { background: #fee2e2; }

  /* Status picker */
  .status-picker {
    position: absolute;
    z-index: 200;
    background: var(--clr-surface);
    border-radius: var(--radius);
    box-shadow: 0 8px 32px rgba(26,22,18,0.18);
    border: 1px solid var(--clr-border);
    padding: 0.5rem;
    min-width: 140px;
    animation: fadeInUp 0.15s ease-out;
  }

  .status-picker__option {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.75rem;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 500;
    transition: background 0.15s;
    border: none;
    background: none;
    width: 100%;
    text-align: right;
    font-family: var(--font-body);
    color: var(--clr-text);
  }

  .status-picker__option:hover { background: #f5f1ec; }

  .status-picker__option--active { background: var(--clr-activity-bg); }

  .status-picker__dot {
    width: 10px;
    height: 10px;
    border-radius: 3px;
    flex-shrink: 0;
  }

  .cal-cell--pending {
    outline: 2px dashed var(--clr-activity);
    outline-offset: -2px;
  }

  .cal-cell--drag-highlight {
    outline: 2px solid #f59e0b;
    outline-offset: -2px;
    filter: brightness(0.95);
  }

  .cal-cell--editable {
    cursor: pointer;
  }

  /* Add People modal */
  .add-people-overlay {
    position: fixed;
    inset: 0;
    background: rgba(26,22,18,0.45);
    z-index: 150;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.2s ease-out;
    padding: 1rem;
  }

  .add-people-modal {
    background: var(--clr-surface);
    border-radius: var(--radius);
    box-shadow: 0 12px 40px rgba(26,22,18,0.2);
    max-width: 400px;
    width: 100%;
    animation: fadeInUp 0.25s ease-out;
    padding: 1.25rem 1.5rem;
  }

  .add-people-modal__title {
    font-family: var(--font-display);
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
    color: var(--clr-text);
  }

  .add-people-modal__desc {
    font-size: 0.85rem;
    color: var(--clr-text-secondary);
    margin-bottom: 0.75rem;
  }

  .add-people-modal__input {
    width: 100%;
    font-family: var(--font-body);
    font-size: 0.95rem;
    padding: 0.6rem 0.75rem;
    border: 1.5px solid var(--clr-border);
    border-radius: 8px;
    direction: rtl;
    resize: vertical;
    min-height: 80px;
    transition: border-color 0.2s;
  }

  .add-people-modal__input:focus {
    outline: none;
    border-color: var(--clr-home);
    box-shadow: 0 0 0 3px rgba(37,99,235,0.12);
  }

  .add-people-modal__warning {
    font-size: 0.8rem;
    color: #dc2626;
    margin-top: 0.5rem;
  }

  .add-people-modal__actions {
    display: flex;
    gap: 0.5rem;
    margin-top: 1rem;
    justify-content: flex-start;
  }

  .add-people-modal__btn {
    font-family: var(--font-body);
    font-size: 0.85rem;
    font-weight: 500;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
  }

  .add-people-modal__btn--add {
    background: var(--clr-home);
    color: #fff;
  }

  .add-people-modal__btn--add:hover { background: #1d4ed8; }

  .add-people-modal__btn--cancel {
    background: #f5f1ec;
    color: var(--clr-text-secondary);
    border: 1px solid var(--clr-border);
  }

  .add-people-modal__btn--cancel:hover { background: #ede8e1; }

  /* Print */
  @media print {
    body { background: #fff; }
    body::before { display: none; }
    .app { padding: 0; max-width: 100%; }
    .controls { break-inside: avoid; }
    .calendar-wrap { box-shadow: none; border: 1px solid #ccc; }
    .cal-cell { min-height: 60px; }
    .filter-select { border: 1px solid #999; box-shadow: none; }
    .examples-fab, .examples-overlay, .examples-panel { display: none; }
    .toolbar, .save-bar, .toast-container, #notePopup, #addPeopleModal { display: none; }
  }
</style>
</head>
<body>
<div class="app">
  <header class="header">
    <h1 class="header__title">××—×œ×§×” 1</h1>
    <p class="header__subtitle">18.6.2026 â€“ 26.4.2026</p>
    <div class="header__line"></div>
    <a class="header__sheet-link" href="https://docs.google.com/spreadsheets/d/e/2PACX-1vRh9ERHvLzkE2yu1cWs7_zMpYo17Hok-w7Eb3m3IfJFxh_Nk-UQJ31CUDz2B-yV5GeDIhb5bUx5RcyJ/pubhtml" target="_blank" rel="noopener">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
      ×¤×ª×— ×’×™×œ×™×•×Ÿ × ×ª×•× ×™×
    </a>
  </header>

  <div class="controls">
    <div class="filter-group">
      <label class="filter-group__label" for="personFilter">×”×¦×’×” ×¢×‘×•×¨:</label>
      <select class="filter-select" id="personFilter">
        <option value="__all__">×›×•×œ×</option>
      </select>
    </div>
    <div class="toolbar" id="toolbar">
      <div class="toolbar__modes" id="toolbarModes" style="display:none;">
        <button class="toolbar__btn" id="btnNote">ğŸ“ ×”×¢×¨×”</button>
        <button class="toolbar__btn" id="btnEdit">âœï¸ ×¢×¨×™×›×”</button>
        <button class="toolbar__btn toolbar__btn--cancel" id="btnCancel" style="display:none;">âŒ ×‘×™×˜×•×œ</button>
      </div>
      <button class="toolbar__btn toolbar__btn--add-people" id="btnAddPeople">â• ×”×•×¡×£ ×× ×©×™×</button>
    </div>
    <div class="legend">
      <span class="legend__item"><span class="legend__dot legend__dot--activity"></span>×‘××•×¦×‘</span>
      <span class="legend__item"><span class="legend__dot legend__dot--home"></span>×‘×‘×™×ª</span>
      <span class="legend__item"><span class="legend__dot legend__dot--switch"></span>××¢×‘×¨</span>
      <span class="legend__item"><span class="legend__dot legend__dot--shabbat"></span>×©×‘×ª</span>
      <span class="legend__item"><span class="legend__dot legend__dot--shavuot"></span>×©×‘×•×¢×•×ª</span>
    </div>
  </div>

  <div class="save-bar" id="saveBar" style="display:none;">
    <span class="save-bar__count" id="saveBarCount"></span>
    <button class="save-bar__btn save-bar__btn--save" id="btnSaveAll">ğŸ’¾ ×©××•×¨ ×©×™× ×•×™×™×</button>
    <button class="save-bar__btn save-bar__btn--discard" id="btnDiscardAll">ğŸ—‘ï¸ ×‘×˜×œ ×”×›×œ</button>
    <button class="save-bar__btn save-bar__btn--undo" id="btnUndo">â†©ï¸ ×‘×˜×œ ××—×¨×•×Ÿ</button>
  </div>

  <div id="calendarContainer">
    <div class="loading">
      <div class="loading__spinner"></div>
      ×˜×•×¢×Ÿ × ×ª×•× ×™×...
    </div>
  </div>

  <div id="dayModal"></div>
  <div id="notePopup"></div>
  <div id="addPeopleModal"></div>
</div>

<div class="toast-container" id="toastContainer"></div>

<!-- Examples popup -->
<button class="examples-fab" id="examplesFab" title="×“×•×’×××•×ª ×œ×¤×§×•×“×•×ª" aria-label="×“×•×’×××•×ª ×œ×¤×§×•×“×•×ª">
  <svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H5.17L4 17.17V4h16v12zM7 9h2v2H7zm4 0h2v2h-2zm4 0h2v2h-2z"/></svg>
</button>

<div class="examples-overlay" id="examplesOverlay"></div>

<div class="examples-panel" id="examplesPanel">
  <div class="examples-panel__header">
    <span class="examples-panel__title">×“×•×’×××•×ª ×œ×¤×§×•×“×•×ª ×‘×•×˜</span>
    <button class="examples-panel__close" id="examplesPanelClose" aria-label="×¡×’×•×¨">&times;</button>
  </div>
  <div class="examples-panel__body" id="examplesPanelBody"></div>
</div>

<script>
(function() {
  const holidays = {
    '2026-05-22': '×©×‘×•×¢×•×ª ××³',
    '2026-05-23': '×©×‘×•×¢×•×ª ×‘×³'
  };

  const specialDays = {
    '2026-04-26': '××œ×´×ª',
    '2026-04-27': '××œ×´×ª',
    '2026-04-28': '××œ×´×ª',
    '2026-04-29': '××œ×´×ª',
    '2026-04-30': '×ª×¤×™×¡×ª ×§×•'
  };

  const dayNames = ['×¨××©×•×Ÿ', '×©× ×™', '×©×œ×™×©×™', '×¨×‘×™×¢×™', '×—××™×©×™', '×©×™×©×™', '×©×‘×ª'];

  const gregMonths = {
    3: '××¤×¨×™×œ', 4: '×××™', 5: '×™×•× ×™'
  };

  // ---- Editing state ----
  const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby-yyvEn8y-SP18lgvd0hmMdoZJqH-m7yR-tcVyR6RqAaGsfd8e4HrZSR0y07-RZAICmQ/exec';
  const DATE_START = '2026-04-26';
  const DATE_END = '2026-06-18';

  let currentMode = null;       // null | 'note' | 'edit'
  let pendingEdits = {};        // "name|YYYY-MM-DD" -> new status
  let undoStack = [];           // { type, key, oldValue }
  let isDragging = false;
  let dragStatus = null;
  let draggedCells = [];
  let currentDataMap = null;
  let currentNotesMap = null;
  let currentNames = null;
  let currentSelectedPerson = '__all__';

  // ---- Utilities ----

  function formatDate(date) {
    const y = date.getFullYear();
    const m = String(date.getMonth() + 1).padStart(2, '0');
    const dd = String(date.getDate()).padStart(2, '0');
    return `${y}-${m}-${dd}`;
  }

  function escapeHtml(str) {
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
  }

  function statusLabel(s) {
    if (s === 'activity') return '×‘××•×¦×‘';
    if (s === 'home') return '×‘×‘×™×ª';
    if (s === 'switch-home') return '×™×•×¦× ×”×‘×™×ª×”';
    return '×—×•×–×¨ ×œ××•×¦×‘';
  }

  // ---- Toast ----

  function showToast(message, type, duration) {
    type = type || 'info';
    duration = duration || 3000;
    const container = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = 'toast toast--' + type;
    toast.textContent = message;
    container.appendChild(toast);
    setTimeout(() => {
      toast.style.animation = 'toastOut 0.3s ease-in forwards';
      toast.addEventListener('animationend', () => toast.remove());
    }, duration);
  }

  // ---- Apps Script API ----

  async function callAppsScript(payload) {
    if (APPS_SCRIPT_URL === 'YOUR_DEPLOYED_APPS_SCRIPT_URL_HERE') {
      showToast('×™×© ×œ×”×’×“×™×¨ ××ª ×›×ª×•×‘×ª Apps Script', 'error', 4000);
      throw new Error('Apps Script URL not configured');
    }
    try {
      const resp = await fetch(APPS_SCRIPT_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain' },
        body: JSON.stringify(payload)
      });
      const result = await resp.json();
      if (!result.success) throw new Error(result.error || 'Unknown error');
      return result;
    } catch (err) {
      showToast('×©×’×™××”: ' + err.message, 'error', 5000);
      throw err;
    }
  }

  // ---- CSV Parsing ----

  function parseCSV(text) {
    text = text.replace(/^\uFEFF/, '');
    const lines = text.trim().split(/\r?\n/);
    if (lines.length < 2) return [];

    const header = lines[0].split(',').map(h => h.trim());
    const nameIdx = header.indexOf('name');
    const dateIdx = header.indexOf('date');
    const statusIdx = header.indexOf('status');
    const noteIdx = header.indexOf('note');

    if (nameIdx === -1 || dateIdx === -1 || statusIdx === -1) return [];

    const rows = [];
    for (let i = 1; i < lines.length; i++) {
      const parts = lines[i].split(',');
      if (parts.length < 3) continue;
      rows.push({
        name: parts[nameIdx].trim(),
        date: parts[dateIdx].trim(),
        status: parts[statusIdx].trim(),
        note: noteIdx !== -1 && parts[noteIdx] ? parts[noteIdx].trim() : ''
      });
    }
    return rows;
  }

  function buildDataMap(rows) {
    const map = {};
    const notesMap = {};
    const names = new Set();
    rows.forEach(r => {
      if (!map[r.date]) map[r.date] = {};
      map[r.date][r.name] = r.status;
      if (r.note) {
        if (!notesMap[r.date]) notesMap[r.date] = {};
        notesMap[r.date][r.name] = r.note;
      }
      names.add(r.name);
    });
    return { map, notesMap, names: [...names].sort() };
  }

  // ---- Rendering ----

  function renderCell(day, dataMap, notesMap, selectedPerson) {
    const key = formatDate(day);
    const dow = day.getDay();
    const isShabbat = dow === 6;
    const holiday = holidays[key] || null;

    let personStatus = null;
    if (selectedPerson !== '__all__') {
      const dayData = dataMap[key] || {};
      personStatus = dayData[selectedPerson] || null;
      // Check pending edits for override
      const pendingKey = selectedPerson + '|' + key;
      if (pendingEdits[pendingKey]) {
        personStatus = pendingEdits[pendingKey];
      }
    }

    let cellClass = 'cal-cell';
    if (isShabbat) cellClass += ' cal-cell--shabbat';
    if (holiday) cellClass += ' cal-cell--shavuot';
    if (personStatus === 'activity') cellClass += ' cal-cell--status-activity';
    if (personStatus === 'home') cellClass += ' cal-cell--status-home';
    if (personStatus === 'switch-home') cellClass += ' cal-cell--status-switch-home';
    if (personStatus === 'switch-base') cellClass += ' cal-cell--status-switch-base';

    if (selectedPerson === '__all__') cellClass += ' cal-cell--clickable';
    if (selectedPerson !== '__all__' && currentMode) cellClass += ' cal-cell--editable';

    // Mark pending cells
    if (selectedPerson !== '__all__' && pendingEdits[selectedPerson + '|' + key]) {
      cellClass += ' cal-cell--pending';
    }

    let html = `<div class="${cellClass}" data-date="${key}">`;

    // Show month name on the 1st of each month
    if (day.getDate() === 1) {
      html += `<span class="cell-month-tag">${gregMonths[day.getMonth()]}</span>`;
    }

    html += '<div class="cell-top">';
    html += `<span class="cell-greg">${day.getDate()}/${day.getMonth() + 1}</span>`;
    html += '</div>';

    if (holiday) {
      html += `<span class="cell-holiday">${holiday}</span>`;
    }

    const special = specialDays[key];
    if (special) {
      html += `<span class="cell-special">${special}</span>`;
    }

    html += '<div class="cell-status">';
    if (selectedPerson === '__all__') {
      const dayData = dataMap[key] || {};
      let actCount = 0, homeCount = 0, switchCount = 0;
      Object.values(dayData).forEach(s => {
        if (s === 'activity') actCount++;
        else if (s === 'home') homeCount++;
        else if (s.startsWith('switch')) switchCount++;
      });
      if (actCount + homeCount + switchCount > 0) {
        html += '<div class="status-summary">';
        if (actCount) html += `<div class="summary-row"><span class="summary-dot summary-dot--activity"></span>${actCount} ×‘××•×¦×‘</div>`;
        if (homeCount) html += `<div class="summary-row"><span class="summary-dot summary-dot--home"></span>${homeCount} ×‘×‘×™×ª</div>`;
        if (switchCount) html += `<div class="summary-row"><span class="summary-dot summary-dot--switch"></span>${switchCount} ××¢×‘×¨</div>`;
        html += '</div>';
      }
    } else if (personStatus) {
      html += `<span class="cell-status-label">${statusLabel(personStatus)}</span>`;
    }
    html += '</div>';

    // Notes
    const dayNotes = notesMap[key] || {};
    if (selectedPerson !== '__all__' && dayNotes[selectedPerson]) {
      html += `<span class="cell-note">${escapeHtml(dayNotes[selectedPerson])}</span>`;
    }

    html += '</div>';
    return html;
  }

  function renderCalendar(dataMap, notesMap, names, selectedPerson) {
    const container = document.getElementById('calendarContainer');

    const allDays = [];
    const d = new Date(2026, 3, 26);
    const end = new Date(2026, 5, 18);
    while (d <= end) {
      allDays.push(new Date(d));
      d.setDate(d.getDate() + 1);
    }

    let html = '<div class="calendar-wrap">';

    html += '<div class="cal-headers">';
    dayNames.forEach((name, i) => {
      html += `<div class="cal-header${i === 6 ? ' cal-header--shabbat' : ''}">${name}</div>`;
    });
    html += '</div>';

    html += '<div class="cal-grid">';

    const firstDow = allDays[0].getDay();
    for (let i = 0; i < firstDow; i++) {
      html += '<div class="cal-cell cal-cell--empty"></div>';
    }

    allDays.forEach(day => {
      html += renderCell(day, dataMap, notesMap, selectedPerson);
    });

    const lastDow = allDays[allDays.length - 1].getDay();
    for (let i = lastDow + 1; i < 7; i++) {
      html += '<div class="cal-cell cal-cell--empty"></div>';
    }

    html += '</div></div>';
    container.innerHTML = html;

    // Attach click handlers
    if (selectedPerson === '__all__') {
      container.querySelectorAll('.cal-cell--clickable').forEach(cell => {
        cell.addEventListener('click', () => {
          const dateKey = cell.getAttribute('data-date');
          showDayModal(dateKey, dataMap, notesMap);
        });
      });
    } else {
      // Individual person â€” mode-aware clicks
      container.querySelectorAll('.cal-cell[data-date]').forEach(cell => {
        if (cell.classList.contains('cal-cell--empty')) return;
        cell.addEventListener('click', (e) => {
          if (isDragging && draggedCells.length > 1) return;
          if (e.target.closest('.status-picker')) return;
          const dateKey = cell.getAttribute('data-date');
          if (currentMode === 'note') {
            showNotePopup(dateKey);
          } else if (currentMode === 'edit') {
            showStatusPicker(cell, dateKey);
          }
        });
      });
    }
  }

  // ---- Day Detail Modal (Everyone view) ----

  function showDayModal(dateKey, dataMap, notesMap) {
    const dayData = dataMap[dateKey] || {};
    const dayNotes = notesMap[dateKey] || {};
    const modalEl = document.getElementById('dayModal');

    const [y, m, d] = dateKey.split('-').map(Number);
    const dateObj = new Date(y, m - 1, d);
    const dayName = dayNames[dateObj.getDay()];
    const dateLabel = `×™×•× ${dayName}, ${d}/${m}`;

    const atBase = [];
    const atHome = [];
    const switching = [];
    Object.entries(dayData).forEach(([name, status]) => {
      const note = dayNotes[name] || '';
      if (status === 'activity') atBase.push({ name, note, sub: '' });
      else if (status === 'home') atHome.push({ name, note, sub: '' });
      else if (status === 'switch-home') switching.push({ name, note, sub: '×™×•×¦× ×”×‘×™×ª×”' });
      else if (status === 'switch-base') switching.push({ name, note, sub: '×—×•×–×¨ ×œ××•×¦×‘' });
    });

    const sortFn = (a, b) => a.name.localeCompare(b.name, 'he');
    atBase.sort(sortFn);
    atHome.sort(sortFn);
    switching.sort(sortFn);

    function renderGroup(title, titleClass, people, personClass) {
      if (people.length === 0) return '';
      let h = `<div class="day-modal__group">`;
      h += `<div class="day-modal__group-title ${titleClass}">${title} (${people.length})</div>`;
      h += `<ul class="day-modal__list">`;
      people.forEach(p => {
        h += `<li class="day-modal__person ${personClass}">`;
        h += `<span>${p.name}${p.sub ? ' â€” ' + p.sub : ''}</span>`;
        if (p.note) h += `<span class="day-modal__person-note">${escapeHtml(p.note)}</span>`;
        h += `</li>`;
      });
      h += `</ul></div>`;
      return h;
    }

    let html = `<div class="day-modal-overlay" id="dayModalOverlay">`;
    html += `<div class="day-modal">`;
    html += `<div class="day-modal__header">`;
    html += `<span class="day-modal__title">${dateLabel}</span>`;
    html += `<button class="day-modal__close" id="dayModalClose">&times;</button>`;
    html += `</div>`;
    html += `<div class="day-modal__body">`;
    html += renderGroup('×‘××•×¦×‘', 'day-modal__group-title--activity', atBase, 'day-modal__person--activity');
    html += renderGroup('×‘×‘×™×ª', 'day-modal__group-title--home', atHome, 'day-modal__person--home');
    html += renderGroup('××¢×‘×¨', 'day-modal__group-title--switch', switching, 'day-modal__person--switch');
    html += `</div></div></div>`;

    modalEl.innerHTML = html;

    document.getElementById('dayModalClose').addEventListener('click', () => { modalEl.innerHTML = ''; });
    document.getElementById('dayModalOverlay').addEventListener('click', (e) => {
      if (e.target === e.currentTarget) modalEl.innerHTML = '';
    });
  }

  // ---- Note Mode ----

  function showNotePopup(dateKey) {
    const person = currentSelectedPerson;
    if (person === '__all__') return;

    const existingNote = (currentNotesMap[dateKey] && currentNotesMap[dateKey][person]) || '';
    const currentNote = existingNote;

    const [y, m, d] = dateKey.split('-').map(Number);
    const dateDisplay = d + '/' + m;

    const popup = document.getElementById('notePopup');
    let html = '<div class="note-popup-overlay" id="notePopupOverlay">';
    html += '<div class="note-popup">';
    html += '<div class="note-popup__title">×”×¢×¨×” ×œ' + escapeHtml(person) + ' â€” ' + dateDisplay + '</div>';
    html += '<textarea class="note-popup__input" id="noteInput" placeholder="×”×§×œ×“ ×”×¢×¨×”...">' + escapeHtml(currentNote) + '</textarea>';
    html += '<div class="note-popup__actions">';
    html += '<button class="note-popup__btn note-popup__btn--save" id="noteSave">×©××•×¨</button>';
    html += '<button class="note-popup__btn note-popup__btn--cancel" id="noteCancel">×‘×™×˜×•×œ</button>';
    if (currentNote) {
      html += '<button class="note-popup__btn note-popup__btn--delete" id="noteDelete">××—×§</button>';
    }
    html += '</div></div></div>';

    popup.innerHTML = html;
    document.getElementById('noteInput').focus();

    document.getElementById('noteSave').addEventListener('click', async () => {
      const newNote = document.getElementById('noteInput').value.trim();
      const btn = document.getElementById('noteSave');
      btn.disabled = true;
      btn.textContent = '×©×•××¨...';
      try {
        await callAppsScript({
          action: 'updateCells',
          edits: [],
          notes: [{ name: person, date: dateKey, note: newNote }]
        });
        if (!currentNotesMap[dateKey]) currentNotesMap[dateKey] = {};
        if (newNote) {
          currentNotesMap[dateKey][person] = newNote;
        } else {
          delete currentNotesMap[dateKey][person];
        }
        popup.innerHTML = '';
        showToast('×”×”×¢×¨×” × ×©××¨×” ×‘×”×¦×œ×—×”', 'success');
        renderCalendar(currentDataMap, currentNotesMap, currentNames, currentSelectedPerson);
      } catch (err) {
        btn.disabled = false;
        btn.textContent = '×©××•×¨';
      }
    });

    document.getElementById('noteCancel').addEventListener('click', () => {
      popup.innerHTML = '';
    });

    const deleteBtn = document.getElementById('noteDelete');
    if (deleteBtn) {
      deleteBtn.addEventListener('click', async () => {
        deleteBtn.disabled = true;
        deleteBtn.textContent = '××•×—×§...';
        try {
          await callAppsScript({
            action: 'updateCells',
            edits: [],
            notes: [{ name: person, date: dateKey, note: '' }]
          });
          if (currentNotesMap[dateKey]) delete currentNotesMap[dateKey][person];
          popup.innerHTML = '';
          showToast('×”×”×¢×¨×” × ××—×§×”', 'success');
          renderCalendar(currentDataMap, currentNotesMap, currentNames, currentSelectedPerson);
        } catch (err) {
          deleteBtn.disabled = false;
          deleteBtn.textContent = '××—×§';
        }
      });
    }

    document.getElementById('notePopupOverlay').addEventListener('click', (e) => {
      if (e.target === e.currentTarget) popup.innerHTML = '';
    });
  }

  // ---- Edit Mode: Status Picker ----

  function showStatusPicker(cellElement, dateKey) {
    removeStatusPicker();

    const person = currentSelectedPerson;
    const pendingKey = person + '|' + dateKey;
    const currentStatus = pendingEdits[pendingKey] ||
      (currentDataMap[dateKey] && currentDataMap[dateKey][person]) || null;

    const options = [
      { value: 'activity', label: '×‘××•×¦×‘', style: 'background:var(--clr-activity)' },
      { value: 'home', label: '×‘×‘×™×ª', style: 'background:var(--clr-home)' },
      { value: 'switch-base', label: '×—×•×–×¨ ×œ××•×¦×‘', style: 'background:linear-gradient(135deg,var(--clr-activity) 50%,var(--clr-home) 50%)' },
      { value: 'switch-home', label: '×™×•×¦× ×”×‘×™×ª×”', style: 'background:linear-gradient(135deg,var(--clr-home) 50%,var(--clr-activity) 50%)' }
    ];

    const picker = document.createElement('div');
    picker.className = 'status-picker';
    picker.id = 'statusPicker';

    options.forEach(opt => {
      const btn = document.createElement('button');
      btn.className = 'status-picker__option' + (currentStatus === opt.value ? ' status-picker__option--active' : '');
      btn.innerHTML = '<span class="status-picker__dot" style="' + opt.style + '"></span>' + opt.label;
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        stageEdit(dateKey, opt.value);
        removeStatusPicker();
      });
      picker.appendChild(btn);
    });

    cellElement.style.position = 'relative';
    cellElement.appendChild(picker);

    setTimeout(() => {
      document.addEventListener('click', closePickerOnOutsideClick);
    }, 10);
  }

  function closePickerOnOutsideClick(e) {
    const picker = document.getElementById('statusPicker');
    if (picker && !picker.contains(e.target)) {
      removeStatusPicker();
    }
  }

  function removeStatusPicker() {
    const existing = document.getElementById('statusPicker');
    if (existing) existing.remove();
    document.removeEventListener('click', closePickerOnOutsideClick);
  }

  function stageEdit(dateKey, newStatus) {
    const person = currentSelectedPerson;
    const pendingKey = person + '|' + dateKey;
    const origStatus = (currentDataMap[dateKey] && currentDataMap[dateKey][person]) || null;
    const prevPending = pendingEdits[pendingKey];

    undoStack.push({
      type: 'edit',
      key: pendingKey,
      oldValue: prevPending !== undefined ? prevPending : origStatus
    });

    // If setting back to original, remove from pending
    if (newStatus === origStatus) {
      delete pendingEdits[pendingKey];
    } else {
      pendingEdits[pendingKey] = newStatus;
    }

    updateCellVisual(dateKey, newStatus, newStatus !== origStatus);
    updateSaveDiscardBar();
  }

  function updateCellVisual(dateKey, newStatus, isPending) {
    const cell = document.querySelector('.cal-cell[data-date="' + dateKey + '"]');
    if (!cell) return;

    cell.classList.remove('cal-cell--status-activity', 'cal-cell--status-home',
      'cal-cell--status-switch-home', 'cal-cell--status-switch-base');

    if (newStatus) {
      cell.classList.add('cal-cell--status-' + newStatus);
    }

    if (isPending) {
      cell.classList.add('cal-cell--pending');
    } else {
      cell.classList.remove('cal-cell--pending');
    }

    const statusDiv = cell.querySelector('.cell-status');
    if (statusDiv && newStatus) {
      statusDiv.innerHTML = '<span class="cell-status-label">' + statusLabel(newStatus) + '</span>';
    }
  }

  // ---- Drag-to-Fill ----

  function setupDragHandlers() {
    const container = document.getElementById('calendarContainer');

    container.addEventListener('mousedown', onDragStart);
    document.addEventListener('mousemove', onDragMove);
    document.addEventListener('mouseup', onDragEnd);

    container.addEventListener('touchstart', onTouchStart, { passive: false });
    document.addEventListener('touchmove', onTouchMove, { passive: false });
    document.addEventListener('touchend', onTouchEnd);
  }

  function getCellFromEvent(e) {
    const el = document.elementFromPoint(e.clientX, e.clientY);
    if (!el) return null;
    const cell = el.closest('.cal-cell[data-date]');
    if (!cell || cell.classList.contains('cal-cell--empty')) return null;
    return cell;
  }

  function getGridRow(dateKey) {
    const startDate = new Date(2026, 3, 26);
    const d = new Date(dateKey);
    const dayOffset = Math.round((d - startDate) / 86400000);
    return Math.floor((dayOffset + startDate.getDay()) / 7);
  }

  let dragStartRow = null;

  function onDragStart(e) {
    if (currentMode !== 'edit') return;
    const cell = e.target.closest('.cal-cell[data-date]');
    if (!cell || cell.classList.contains('cal-cell--empty')) return;
    if (e.target.closest('.status-picker')) return;

    const dateKey = cell.getAttribute('data-date');
    const person = currentSelectedPerson;
    const pendingKey = person + '|' + dateKey;

    dragStatus = pendingEdits[pendingKey] ||
      (currentDataMap[dateKey] && currentDataMap[dateKey][person]) || 'activity';

    isDragging = true;
    dragStartRow = getGridRow(dateKey);
    draggedCells = [dateKey];

    cell.classList.add('cal-cell--drag-highlight');
    e.preventDefault();
  }

  function onDragMove(e) {
    if (!isDragging || currentMode !== 'edit') return;

    const cell = getCellFromEvent(e);
    if (!cell) return;

    const dateKey = cell.getAttribute('data-date');
    if (draggedCells.includes(dateKey)) return;

    if (getGridRow(dateKey) === dragStartRow) {
      draggedCells.push(dateKey);
      stageEdit(dateKey, dragStatus);
      cell.classList.add('cal-cell--drag-highlight');
    }
  }

  function onDragEnd() {
    if (!isDragging) return;
    isDragging = false;
    dragStartRow = null;

    document.querySelectorAll('.cal-cell--drag-highlight').forEach(c => {
      c.classList.remove('cal-cell--drag-highlight');
    });

    draggedCells = [];
    updateSaveDiscardBar();
  }

  function onTouchStart(e) {
    if (currentMode !== 'edit') return;
    const touch = e.touches[0];
    const el = document.elementFromPoint(touch.clientX, touch.clientY);
    if (!el) return;
    const cell = el.closest('.cal-cell[data-date]');
    if (cell && !cell.classList.contains('cal-cell--empty') && !el.closest('.status-picker')) {
      e.preventDefault();
      onDragStart({
        target: cell,
        clientX: touch.clientX,
        clientY: touch.clientY,
        preventDefault: function() {}
      });
    }
  }

  function onTouchMove(e) {
    if (!isDragging) return;
    e.preventDefault();
    const touch = e.touches[0];
    onDragMove({ clientX: touch.clientX, clientY: touch.clientY });
  }

  function onTouchEnd() {
    onDragEnd();
  }

  // ---- Save / Discard Bar ----

  function updateSaveDiscardBar() {
    const count = Object.keys(pendingEdits).length;
    const bar = document.getElementById('saveBar');
    const counter = document.getElementById('saveBarCount');

    if (count === 0) {
      bar.style.display = 'none';
      return;
    }

    bar.style.display = 'flex';
    counter.textContent = count + ' ×©×™× ×•×™×™× ×××ª×™× ×™×';
  }

  async function saveAllEdits() {
    const edits = [];
    Object.entries(pendingEdits).forEach(([key, status]) => {
      const sep = key.indexOf('|');
      const name = key.substring(0, sep);
      const date = key.substring(sep + 1);
      edits.push({ name, date, status });
    });

    if (edits.length === 0) {
      showToast('××™×Ÿ ×©×™× ×•×™×™× ×œ×©××™×¨×”', 'info');
      return;
    }

    const btn = document.getElementById('btnSaveAll');
    btn.disabled = true;
    btn.textContent = '×©×•××¨...';

    try {
      await callAppsScript({
        action: 'updateCells',
        edits: edits,
        notes: []
      });

      edits.forEach(edit => {
        if (!currentDataMap[edit.date]) currentDataMap[edit.date] = {};
        currentDataMap[edit.date][edit.name] = edit.status;
      });

      pendingEdits = {};
      undoStack = [];

      showToast('× ×©××¨×• ' + edits.length + ' ×©×™× ×•×™×™× ×‘×”×¦×œ×—×”', 'success');
      renderCalendar(currentDataMap, currentNotesMap, currentNames, currentSelectedPerson);
      document.getElementById('saveBar').style.display = 'none';
    } catch (err) {
      // Error toast shown by callAppsScript
    } finally {
      btn.disabled = false;
      btn.textContent = 'ğŸ’¾ ×©××•×¨ ×©×™× ×•×™×™×';
    }
  }

  function discardAllEdits() {
    pendingEdits = {};
    undoStack = [];
    renderCalendar(currentDataMap, currentNotesMap, currentNames, currentSelectedPerson);
    document.getElementById('saveBar').style.display = 'none';
    showToast('×›×œ ×”×©×™× ×•×™×™× ×‘×•×˜×œ×•', 'info');
  }

  function undoLastEdit() {
    if (undoStack.length === 0) {
      showToast('××™×Ÿ ××” ×œ×‘×˜×œ', 'info');
      return;
    }

    const last = undoStack.pop();
    if (last.type === 'edit') {
      const sep = last.key.indexOf('|');
      const name = last.key.substring(0, sep);
      const dateKey = last.key.substring(sep + 1);
      const origStatus = (currentDataMap[dateKey] && currentDataMap[dateKey][name]) || null;

      if (last.oldValue === origStatus || last.oldValue === null) {
        delete pendingEdits[last.key];
      } else {
        pendingEdits[last.key] = last.oldValue;
      }

      const currentStatus = pendingEdits[last.key] || origStatus;
      updateCellVisual(dateKey, currentStatus, !!pendingEdits[last.key]);
    }

    updateSaveDiscardBar();
  }

  // ---- Add People Modal ----

  function showAddPeopleModal() {
    const modal = document.getElementById('addPeopleModal');

    let html = '<div class="add-people-overlay" id="addPeopleOverlay">';
    html += '<div class="add-people-modal">';
    html += '<div class="add-people-modal__title">×”×•×¡×¤×ª ×× ×©×™×</div>';
    html += '<div class="add-people-modal__desc">×”×›× ×¡ ×©××•×ª, ××•×¤×¨×“×™× ×‘×¤×¡×™×§ ××• ×©×•×¨×” ×—×“×©×”</div>';
    html += '<textarea class="add-people-modal__input" id="addPeopleInput" placeholder="×©× ×¨××©×•×Ÿ, ×©× ×©× ×™&#10;×©× ×©×œ×™×©×™"></textarea>';
    html += '<div class="add-people-modal__warning" id="addPeopleWarning" style="display:none;"></div>';
    html += '<div class="add-people-modal__actions">';
    html += '<button class="add-people-modal__btn add-people-modal__btn--add" id="addPeopleSubmit">×”×•×¡×£</button>';
    html += '<button class="add-people-modal__btn add-people-modal__btn--cancel" id="addPeopleCancel">×‘×™×˜×•×œ</button>';
    html += '</div></div></div>';

    modal.innerHTML = html;
    document.getElementById('addPeopleInput').focus();

    document.getElementById('addPeopleSubmit').addEventListener('click', handleAddPeople);
    document.getElementById('addPeopleCancel').addEventListener('click', () => { modal.innerHTML = ''; });
    document.getElementById('addPeopleOverlay').addEventListener('click', (e) => {
      if (e.target === e.currentTarget) modal.innerHTML = '';
    });
  }

  async function handleAddPeople() {
    const input = document.getElementById('addPeopleInput').value;
    const warning = document.getElementById('addPeopleWarning');

    const names = input
      .split(/[,\n]/)
      .map(n => n.trim())
      .filter(n => n.length > 0);

    if (names.length === 0) {
      warning.textContent = '×™×© ×œ×”×–×™×Ÿ ×œ×¤×—×•×ª ×©× ××—×“';
      warning.style.display = 'block';
      return;
    }

    const duplicates = names.filter(n => currentNames.includes(n));
    const newNames = names.filter(n => !currentNames.includes(n));

    if (newNames.length === 0) {
      warning.textContent = '×›×œ ×”×©××•×ª ×©×”×•×–× ×• ×›×‘×¨ ×§×™×™××™× ×‘××¢×¨×›×ª';
      warning.style.display = 'block';
      return;
    }

    if (duplicates.length > 0) {
      warning.textContent = '×©××•×ª ×©×›×‘×¨ ×§×™×™××™× (×™×“×œ×’×•): ' + duplicates.join(', ');
      warning.style.display = 'block';
    }

    const btn = document.getElementById('addPeopleSubmit');
    btn.disabled = true;
    btn.textContent = '××•×¡×™×£...';

    try {
      await callAppsScript({
        action: 'addPeople',
        names: newNames,
        dateRange: { start: DATE_START, end: DATE_END },
        defaultStatus: 'activity'
      });

      document.getElementById('addPeopleModal').innerHTML = '';
      showToast('× ×•×¡×¤×• ' + newNames.length + ' ×× ×©×™× ×‘×”×¦×œ×—×”. ×˜×•×¢×Ÿ ××—×“×©...', 'success', 3000);

      setTimeout(() => location.reload(), 2000);
    } catch (err) {
      btn.disabled = false;
      btn.textContent = '×”×•×¡×£';
    }
  }

  // ---- Toolbar Setup ----

  function setupToolbar() {
    const modes = document.getElementById('toolbarModes');
    const btnNote = document.getElementById('btnNote');
    const btnEdit = document.getElementById('btnEdit');
    const btnCancel = document.getElementById('btnCancel');
    const btnAddPeople = document.getElementById('btnAddPeople');

    function updateToolbarVisibility() {
      modes.style.display = currentSelectedPerson === '__all__' ? 'none' : 'flex';
    }

    function setMode(mode) {
      currentMode = mode;
      btnNote.classList.toggle('toolbar__btn--active', mode === 'note');
      btnEdit.classList.toggle('toolbar__btn--active', mode === 'edit');
      btnCancel.style.display = mode ? '' : 'none';
      removeStatusPicker();
    }

    btnNote.addEventListener('click', () => setMode(currentMode === 'note' ? null : 'note'));
    btnEdit.addEventListener('click', () => setMode(currentMode === 'edit' ? null : 'edit'));
    btnCancel.addEventListener('click', () => {
      setMode(null);
      if (Object.keys(pendingEdits).length > 0) {
        discardAllEdits();
      }
    });
    btnAddPeople.addEventListener('click', showAddPeopleModal);

    return { updateToolbarVisibility, setMode };
  }

  // ---- Fallback data ----

  function generateFallbackData() {
    const names = ['×’×™×œ ×–××‘×™','××‘×™×¨×Ÿ ×’×¨×™×Ÿ','×œ×¨×”','××™×” ×™×“×™×“×”','×¢××™×ª ×•×™×™×¡','×©×¨×•×Ÿ ×›×”×Ÿ','××œ×•×Ÿ ×’×œ×¤×¨×™×Ÿ','×›×¨××œ ××œ×™××œ×š','×™×•××‘ ××©×“','×©× ×™ ×œ××•× ×•×‘','××œ×™×–×‘×ª','×©×™ ×™×¤×¨×—','×©× ×”×‘'];
    const rows = [];
    const d = new Date(2026, 3, 26);
    const end = new Date(2026, 5, 18);
    let seed = 42;
    function pseudoRandom() {
      seed = (seed * 16807 + 0) % 2147483647;
      return seed / 2147483647;
    }
    while (d <= end) {
      const key = formatDate(d);
      names.forEach(name => {
        const r = pseudoRandom();
        rows.push({ name, date: key, status: r > 0.6 ? 'activity' : r > 0.15 ? 'home' : 'switch' });
      });
      d.setDate(d.getDate() + 1);
    }
    return rows;
  }

  // ---- Init ----

  async function init() {
    let rows;
    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRh9ERHvLzkE2yu1cWs7_zMpYo17Hok-w7Eb3m3IfJFxh_Nk-UQJ31CUDz2B-yV5GeDIhb5bUx5RcyJ/pub?output=csv';
    try {
      const resp = await fetch(SHEET_URL);
      if (!resp.ok) throw new Error('fetch failed');
      const text = await resp.text();
      rows = parseCSV(text);
      if (rows.length === 0) throw new Error('empty CSV');
    } catch (e) {
      console.warn('Google Sheets fetch failed, trying local backup:', e);
      try {
        const resp = await fetch('data.csv');
        if (!resp.ok) throw new Error('local fetch failed');
        const text = await resp.text();
        rows = parseCSV(text);
        if (rows.length === 0) throw new Error('empty local CSV');
      } catch (e2) {
        console.warn('Local CSV also failed, using fallback data:', e2);
        rows = generateFallbackData();
      }
    }

    const { map, notesMap, names } = buildDataMap(rows);

    // Store global refs
    currentDataMap = map;
    currentNotesMap = notesMap;
    currentNames = names;

    const select = document.getElementById('personFilter');
    const commander = '×’×™×œ ×–××‘×™';
    const sortedNames = [commander, ...names.filter(n => n !== commander)];
    sortedNames.forEach(name => {
      const opt = document.createElement('option');
      opt.value = name;
      opt.textContent = name === commander ? 'â­ ' + name : name;
      select.appendChild(opt);
    });

    renderCalendar(map, notesMap, names, '__all__');

    // Setup toolbar
    const toolbarCtrl = setupToolbar();
    toolbarCtrl.updateToolbarVisibility();

    // Setup drag handlers
    setupDragHandlers();

    // Setup save/discard buttons
    document.getElementById('btnSaveAll').addEventListener('click', saveAllEdits);
    document.getElementById('btnDiscardAll').addEventListener('click', discardAllEdits);
    document.getElementById('btnUndo').addEventListener('click', undoLastEdit);

    // Dropdown change handler
    select.addEventListener('change', () => {
      currentSelectedPerson = select.value;
      currentMode = null;
      pendingEdits = {};
      undoStack = [];
      renderCalendar(map, notesMap, names, select.value);
      toolbarCtrl.updateToolbarVisibility();
      toolbarCtrl.setMode(null);
      document.getElementById('saveBar').style.display = 'none';
    });

    // Undo keyboard shortcut
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === 'z' && currentMode === 'edit') {
        e.preventDefault();
        undoLastEdit();
      }
    });

    // Warn before leaving with unsaved edits
    window.addEventListener('beforeunload', (e) => {
      if (Object.keys(pendingEdits).length > 0) {
        e.preventDefault();
        e.returnValue = '';
      }
    });
  }

  init();
})();

// Examples popup logic
(function() {
  const examples = [
    { label: '×™×¦×™××”', text: '×’×™×œ ×–××‘×™ ×™×•×¦× ×”×‘×™×ª×” ×‘-15.05 ×•×—×•×–×¨ ×‘-20.05' },
    { label: '×™×¦×™××” + ×œ×•×— ×©×œ×', text: '×’×™×œ ×–××‘×™ ×‘××•×¦×‘ ×-01.05 ×¢×“ 30.05, ×™×•×¦× ×‘-15.05 ×•×—×•×–×¨ ×‘-20.05' },
    { label: '×‘×™×˜×•×œ ×—×•×¤×©×”', text: '×’×™×œ ×–××‘×™ ××‘×˜×œ ××ª ×”×—×•×¤×©×” ×-15.05 ×¢×“ 20.05' },
    { label: '×”××¨×›×ª ×—×•×¤×©×”', text: '×’×™×œ ×–××‘×™ ×××¨×™×š ×¢×“ 22.05' },
    { label: '×”×•×¡×¤×ª ××“×', text: '×ª×•×¡×™×£ ××ª ×’×™×œ ×–××‘×™' },
    { label: '×”×¡×¨×ª ××“×', text: '×ª×¡×™×¨ ××ª ×’×™×œ ×–××‘×™' },
    { label: '×”×¢×¨×”', text: '×”×¢×¨×” ×œ×’×™×œ ×–××‘×™ ×‘-15.05: ×ª×•×¨× ×•×ª' },
    { label: '×”×—×œ×¤×”', text: '×’×™×œ ×–××‘×™ ×•×™×•×¡×™ ×›×”×Ÿ ××—×œ×™×¤×™× ×-15.05 ×¢×“ 20.05' },
    { label: '×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡', text: '×›×•×œ× ×‘×¤×¢×™×œ×•×ª ×-01.05 ×¢×“ 10.05' },
    { label: '×ª×•×›× ×™×ª ××—×–×•×¨×™×ª', text: '×ª×•×›× ×™×ª ×™×¦×™××•×ª ×œ×’×™×œ ×–××‘×™ ××ª×›×•× ×ª 10-4 ×-01.05 ×¢×“ 30.06' },
    { label: '×”×¢×ª×§×ª ×”×¢×¨×•×ª', text: '×ª×¢×ª×™×§ ×”×¢×¨×•×ª ××’×™×œ ×–××‘×™ ×œ×™×•×¡×™ ×›×”×Ÿ' },
    { label: '×”×¢×ª×§×ª ×ª×•×›× ×™×ª', text: '×ª×¢×ª×™×§ ×ª×•×›× ×™×ª ××’×™×œ ×–××‘×™ ×œ×™×•×¡×™ ×›×”×Ÿ' },
    { label: '×©××™×œ×ª×”', text: '××™ ×‘×‘×™×ª ×‘-15.05?' },
    { label: '×©××™×œ×ª×”', text: '××” ×”×¡×˜×˜×•×¡ ×©×œ ×’×™×œ ×–××‘×™?' },
    { label: '×‘×™×˜×•×œ ×©×™× ×•×™×™×', text: '×ª×‘×˜×œ ×©×™× ×•×™×™×' }
  ];

  const copySvg = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>';
  const checkSvg = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>';

  const body = document.getElementById('examplesPanelBody');
  let html = '';
  examples.forEach(function(ex, i) {
    html += '<div class="example-item">';
    html += '<div class="example-item__label">' + ex.label + '</div>';
    html += '<div class="example-item__row">';
    html += '<span class="example-item__text">' + ex.text + '</span>';
    html += '<button class="example-item__copy" data-idx="' + i + '" aria-label="×”×¢×ª×§">';
    html += '<span class="example-item__feedback">×”×•×¢×ª×§!</span>';
    html += copySvg;
    html += '</button>';
    html += '</div></div>';
  });
  body.innerHTML = html;

  var fab = document.getElementById('examplesFab');
  var overlay = document.getElementById('examplesOverlay');
  var panel = document.getElementById('examplesPanel');
  var closeBtn = document.getElementById('examplesPanelClose');

  function openPanel() {
    overlay.classList.add('examples-overlay--open');
    panel.classList.add('examples-panel--open');
  }

  function closePanel() {
    overlay.classList.remove('examples-overlay--open');
    panel.classList.remove('examples-panel--open');
  }

  fab.addEventListener('click', openPanel);
  overlay.addEventListener('click', closePanel);
  closeBtn.addEventListener('click', closePanel);

  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') closePanel();
  });

  body.addEventListener('click', function(e) {
    var btn = e.target.closest('.example-item__copy');
    if (!btn) return;
    var idx = parseInt(btn.getAttribute('data-idx'), 10);
    var text = examples[idx].text;
    navigator.clipboard.writeText(text).then(function() {
      btn.classList.add('example-item__copy--copied');
      btn.innerHTML = '<span class="example-item__feedback example-item__feedback--show">×”×•×¢×ª×§!</span>' + checkSvg;
      setTimeout(function() {
        btn.classList.remove('example-item__copy--copied');
        btn.innerHTML = '<span class="example-item__feedback">×”×•×¢×ª×§!</span>' + copySvg;
      }, 1500);
    });
  });
})();
</script>
</body>
</html>
